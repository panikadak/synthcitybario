var Perlin=function(i){this.alea_rand=null!=i?new Alea(i):new Alea,this.PERLIN_YWRAPB=4,this.PERLIN_YWRAP=1<<this.PERLIN_YWRAPB,this.PERLIN_ZWRAPB=8,this.PERLIN_ZWRAP=1<<this.PERLIN_ZWRAPB,this.PERLIN_SIZE=4095,this.perlin_octaves=4,this.perlin_amp_falloff=.5,this.perlin_array=new Array;var r=Math.floor(720);this.cosLUT=new Array;for(var t=0;t<r;t++)this.cosLUT[t]=Math.cos(.0174532925*t*.5);this.perlin_TWOPI=r,this.perlin_PI=r,this.perlin_PI>>=1};Perlin.prototype.noiseReseed=function(){this.alea_rand=new Alea,this.perlin_array=new Array},Perlin.prototype.noiseSeed=function(i){this.alea_rand=new Alea(i),this.perlin_array=new Array},Perlin.prototype.noiseDetail=function(i,r){Math.floor(i)>0&&(this.perlin_octaves=Math.floor(i)),null!=r&&r>0&&(this.perlin_amp_falloff=r)},Perlin.prototype.noise_fsc=function(i){return.5*(1-this.cosLUT[Math.floor(i*this.perlin_PI)%this.perlin_TWOPI])},Perlin.prototype.noise=function(i,r,t){if(null==i)return!1;if(null==r&&(r=0),null==t&&(t=0),0==this.perlin_array.length){this.perlin_array=new Array;for(var s=0;s<this.PERLIN_SIZE+1;s++)this.perlin_array[s]=this.alea_rand()}var e,a,n,h,l,_=Math.floor(i),o=Math.floor(r),P=Math.floor(t),p=i-_,I=r-o,R=t-P,E=0,f=.5;for(s=0;s<this.perlin_octaves;s++){var L=_+(o<<this.PERLIN_YWRAPB)+(P<<this.PERLIN_ZWRAPB);e=this.noise_fsc(p),a=this.noise_fsc(I),n=this.perlin_array[L&this.PERLIN_SIZE],n+=e*(this.perlin_array[L+1&this.PERLIN_SIZE]-n),h=this.perlin_array[L+this.PERLIN_YWRAP&this.PERLIN_SIZE],n+=a*((h+=e*(this.perlin_array[L+this.PERLIN_YWRAP+1&this.PERLIN_SIZE]-h))-n),L+=this.PERLIN_ZWRAP,h=this.perlin_array[L&this.PERLIN_SIZE],h+=e*(this.perlin_array[L+1&this.PERLIN_SIZE]-h),l=this.perlin_array[L+this.PERLIN_YWRAP&this.PERLIN_SIZE],h+=a*((l+=e*(this.perlin_array[L+this.PERLIN_YWRAP+1&this.PERLIN_SIZE]-l))-h),E+=(n+=this.noise_fsc(R)*(h-n))*f,f*=this.perlin_amp_falloff,_<<=1,o<<=1,P<<=1,(p*=2)>=1&&(_++,p--),(I*=2)>=1&&(o++,I--),(R*=2)>=1&&(P++,R--)}return E};